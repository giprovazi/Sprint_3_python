import tkinter as tk
from tkinter import messagebox
import csv
from datetime import datetime

nome_usuario = "Paciente"
quarto_usuario = "001"

categorias = {
    "ProteÃ­nas ğŸ–": [
        "Frango Grelhado ğŸ—", "Carne Assada ğŸ¥©", "Ovo Cozido ğŸ³", "Costelinha ğŸ–", "Peixe Assado ğŸŸ",
        "HambÃºrguer ğŸ”", "FilÃ© de Frango ğŸ—", "AlmÃ´ndega ğŸ", "Tofu ğŸ£", "LinguiÃ§a ğŸŒ­"
    ],
    "Acompanhamentos ğŸš": [
        "Arroz ğŸš", "FeijÃ£o ğŸ²", "Salada ğŸ¥—", "MacarrÃ£o ğŸ", "Batata Cozida ğŸ¥”",
        "Alface ğŸ¥¬", "Pepino ğŸ¥’", "Cenoura ğŸ¥•", "Milho ğŸŒ½", "Ervilha ğŸŸ¢",
        "Torrada ğŸ", "PÃ£o ğŸ", "PurÃª de Batata ğŸ¥”", "Farofa ğŸ½ï¸", "BrÃ³colis ğŸ¥¦"
        
    ],
    "Sobremesas ğŸ“": [
        "Morango ğŸ“", "Uva ğŸ‡", "MaÃ§Ã£ ğŸ", "Abacaxi ğŸ", "Cereja ğŸ’",
        "Melancia ğŸ‰", "Banana ğŸŒ", "LimÃ£o ğŸ‹", "Laranja ğŸŠ", "Chocolate ğŸ«",
        "Sorvete ğŸ¦", "Bolo ğŸ‚", "Pudim ğŸ®", "Gelatina ğŸ§", "Iogurte ğŸ¨"
    ]
}

alimentos_vars = {}

def listar_alimentos_selecionados():
    return [alimento for alimento, var in alimentos_vars.items() if var.get() == 1]

def salvar_escolhas_csv(selecionados):
    agora = datetime.now()
    data = agora.strftime("%Y-%m-%d")
    hora = agora.strftime("%H:%M:%S")
    with open('refeicoes.csv', mode='a', newline='', encoding='utf-8') as arquivo_csv:
        writer = csv.writer(arquivo_csv)
        writer.writerow([nome_usuario, quarto_usuario, data, hora, "; ".join(selecionados)])

def confirmar_escolhas():
    selecionados = listar_alimentos_selecionados()
    if not selecionados:
        messagebox.showwarning("Nenhum alimento", "Por favor, selecione pelo menos um alimento.")
        return
    resposta = messagebox.askyesno("Editar Escolhas", "Deseja remover algum alimento antes de confirmar?")
    if resposta:
        remover_alimentos(selecionados)
        return
    salvar_escolhas_csv(selecionados)
    mensagem = "VocÃª selecionou:\n" + "\n".join(f"- {a}" for a in selecionados)
    messagebox.showinfo("Alimentos Escolhidos", mensagem)

def remover_alimentos(selecionados):
    for alimento in selecionados:
        if messagebox.askyesno("Remover Alimento", f"Deseja remover {alimento}?"):
            alimentos_vars[alimento].set(0)

root = tk.Tk()
root.title("NutriSabarÃ¡")
root.configure(bg="#1f4e79")
root.geometry("900x800")

frame = tk.Frame(root, bg="#1f4e79")
frame.pack(pady=10)

tk.Label(frame, text="NutriSabarÃ¡", font=("Arial", 28, "bold"), fg="red", bg="#1f4e79").grid(row=0, column=0, columnspan=3, pady=20)

coluna = 0
for categoria, itens in categorias.items():
    tk.Label(frame, text=categoria, font=("Arial", 18, "bold"), fg="white", bg="#1f4e79").grid(row=1, column=coluna, sticky="w", padx=20, pady=(10, 5))
    for idx, alimento in enumerate(itens, start=2):
        var = tk.IntVar()
        alimentos_vars[alimento] = var
        chk = tk.Checkbutton(frame, text=alimento, variable=var, font=("Arial", 14),
                             bg="#1f4e79", fg="white", activebackground="#1f4e79",
                             activeforeground="white", selectcolor="#1f4e79")
        chk.grid(row=idx, column=coluna, sticky="w", padx=40)
    coluna += 1

botao = tk.Button(frame, text="Confirmar Escolhas", font=("Arial", 16, "bold"),
                  bg="red", fg="white", command=confirmar_escolhas)
botao.grid(row=30, column=0, columnspan=3, pady=40)

root.mainloop()
